#define BUTTON_PIN 13  // GPIO21 pin connected to button
#define DEBOUNCE_TIME  50 // debounce time in milliseconds

// Variables will change:
int lastSteadyState = LOW;       // previous stable state
int lastFlickerableState = LOW;  // previous flickerable state
int currentState;                // current reading

unsigned long lastDebounceTime = 0;  // last time state changed

// Comptador de pulsacions
unsigned int buttonCounter = 0;

void setup() {
  Serial.begin(9600);
  pinMode(BUTTON_PIN, INPUT_PULLUP);
}

void loop() {
  currentState = digitalRead(BUTTON_PIN);

  // Si l'estat ha canviat (per soroll o pulsació)
  if (currentState != lastFlickerableState) {
    lastDebounceTime = millis();
    lastFlickerableState = currentState;
  }

  if ((millis() - lastDebounceTime) > DEBOUNCE_TIME) {
    // Si l'estat és estable
    if (lastSteadyState == HIGH && currentState == LOW) {
      // Botó premut → incrementem comptador
      buttonCounter++;
      Serial.print("Botó premut. Comptador = ");
      Serial.println(buttonCounter);
    }
    else if (lastSteadyState == LOW && currentState == HIGH) {
      Serial.println("Botó alliberat");
    }

    lastSteadyState = currentState;
  }
}
